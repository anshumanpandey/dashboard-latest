@model NHS.Common.DTO.clsDeclarationModel
@{
    ViewBag.Title = "Declaration";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br />
<br />
<div class="container">
    <div class="row form-group">
        <div class="col-xs-12 col-lg-12">
            <div class="row" align="right">
                <div class="col-md-12">
                    <input type="image" src="~/images/Delete.png" width="30" height="30" alt="Submit" id="btnClose6" title="Close" />
                </div>
            </div>
            <ul class="nav nav-pills nav-justified thumbnail setup-panel">
                <li class="disabled">
                    <a href='@Url.Action("PatientDetails", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Patient details
                        </h4>
                    </a>

                </li>
                <li class="disabled">
                    <a href='@Url.Action("MedicalExaminerReview", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner<br /> Scrutiny
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("MedicalExaminerDecision", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner Decision
                        </h4>
                    </a>
                </li>

                <li class="disabled">
                    <a href='@Url.Action("SJRAssessmentTriage", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            SJR Assessment<br /> Triage
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("OtherReferrals", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Other Referrals
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("PositiveFeedback", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Positive Feedback
                        </h4>
                    </a>
                </li>
                <li class="active">
                    <a href='@Url.Action("Declaration", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Declaration
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("FinalOutcome", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Final Outcome<br />(MEO)
                        </h4>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="row setup-content" id="step-6">
        <div class="col-xs-12 col-lg-12">
            @*@using (Html.BeginForm("Declaration", "Home", FormMethod.Post, new { @id = Model.Patient_ID }))
            {*@
                <div class="col-md-12 well">
                    <div class="form-section">
                        <div class="lable_title">
                            <h2>DECLARATION</h2>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row_bar checkbox-row">
                                    @if (Convert.ToBoolean(ViewBag.IsReadOnly))
                                    {
                                    if (Model.MedTriage == 3)
                                    {

                                            if (Model.Declaration == true)
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                            else
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                        }
                                        else if (Model.CreatedBy == Convert.ToString(Session["UserName"]) || Convert.ToString(Session["Role"]).ToUpper() == "ADMIN")
                                        {
                                            if (Model.Declaration == true)
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                            else
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                        }
                                        else
                                        {
                                            if (Model.Declaration == true)
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                            else
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                        }
                                    }
                                    else
                                    {
                                        if (Model.CreatedBy.ToUpper() == Convert.ToString(Session["FullName"]).ToUpper() || Convert.ToString(Session["Role"]).ToUpper() == "ADMIN")
                                        {
                                            if (Model.Declaration == true)
                                            {
                                                if (Model.Declaration == true)
                                                {
                                                    <input type="checkbox" disabled id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                                }
                                                else
                                                {
                                                    <input type="checkbox" disabled id="Declaration" name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                                }
                                            }
                                            else
                                            {
                                                if (Model.Declaration == true)
                                                {
                                                <input type="checkbox" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                                }
                                                else
                                                {
                                                <input type="checkbox" id="Declaration" name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                                }
                                            }
                                        }
                                        else if(Model.MedTriage == 3)
                                        {

                                            if (Model.Declaration == true)
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                            else
                                            {
                                                <input type="checkbox" disabled="disabled" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                                }
                                         
                                        else
                                        {
                                                    if (Model.Declaration == true)
                                                    {
                                                <input type="checkbox" id="Declaration" checked name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                            else
                                            {
                                                <input type="checkbox" id="Declaration" name="Declaration"><span>I confirm that I have carried out an independent and proportionate scrutiny of this death in a way that complies with the relevant standards and procedures.</span>
                                            }
                                                    }
                                                }
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    @if (Model.Declaration == false)
                                    {
                                        <div class="col-md-6" id="dvNameLabel" style="display:none">
                                            <div class="row_bar">
                                                <span><b><i>Name of medical examiner (print)</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvNameSpan" style="display:none">
                                            <div class="row_bar">
                                                @if (!string.IsNullOrEmpty(Model.CreatedBy))
                                                {
                                                    <span><b><i>@Model.CreatedBy</i></b></span>
                                                }
                                                else
                                                {
                                                    if (Session["FullName"] != null)
                                                    {
                                                        <span><b><i>@Convert.ToString(Session["FullName"])</i></b></span>
                                                    }
                                                    else
                                                    {
                                                        <span>&nbsp;</span>
                                                    }
                                                }
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvOfficeLabel" style="display:none">
                                            <div class="row_bar">
                                                <span><b><i>Office</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvOfficeSpan" style="display:none">
                                            <div class="row_bar">
                                                <span><b><i>Royal Berkshire Hospital</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvDateLabel" style="display:none">
                                            <div class="row_bar">
                                                <span><b><i>Date</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvDateSpan" style="display:none">
                                            <div class="row_bar">
                                                @if (!string.IsNullOrEmpty(Model.CreatedDate))
                                                {
                                                    <span><b><i>@Model.CreatedDate</i></b></span>
                                                }
                                                else
                                                {
                                                    <span><b><i>@DateTime.Now.ToString("dd/MM/yyyy")</i></b></span>
                                                }
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-md-6" id="dvNameLabel" style="display:block">
                                            <div class="row_bar">
                                                <span><b><i>Name of medical examiner (print)</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvNameSpan" style="display:block">
                                            <div class="row_bar">
                                                @if (!string.IsNullOrEmpty(Model.CreatedBy))
                                                {
                                                    <span><b><i>@Model.CreatedBy</i></b></span>
                                                }
                                                else
                                                {
                                                    if (Session["FullName"] != null)
                                                    {
                                                        <span><b><i>@Convert.ToString(Session["FullName"])</i></b></span>
                                                    }
                                                    else
                                                    {
                                                        <span>&nbsp;</span>
                                                    }
                                                }
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvSpeciality" style="display:none">
                                            <div class="row_bar">
                                                <span><b><i>Reviewer Speciality</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvddlSpeciality" style="display:none">
                                            <div class="row_bar checkbox-row">
                                                <select class="form-control" id="ddlSpeciality" disabled name="ddlSpeciality">
                                                    <option value="" selected="">Please Select</option>
                                                    @foreach (var item in ViewBag.SpecialityDDM)
                                                    {
                                                        if (Model.SpecialityID == item.SpecialityID)
                                                        {
                                                            <option selected value="@item.SpecialityID">@item.SpecialityName</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.SpecialityID">@item.SpecialityName</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvOfficeLabel" style="display:block">
                                            <div class="row_bar">
                                                <span><b><i>Office</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvOfficeSpan" style="display:block">
                                            <div class="row_bar">
                                                <span><b><i>Royal Berkshire Hospital</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvDateLabel" style="display:block">
                                            <div class="row_bar">
                                                <span><b><i>Date</i></b></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="dvDateSpan" style="display:block">
                                            <div class="row_bar">
                                                @if (!string.IsNullOrEmpty(Model.CreatedDate))
                                                {
                                                    <span><b><i>@Model.CreatedDate</i></b></span>
                                                }
                                                else
                                                {
                                                    <span><b><i>@DateTime.Now.ToString("dd/MM/yyyy")</i></b></span>
                                                }
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="table_margin">
                                    <table width="100%" style="border-collapse:separate;border:solid black 1px;border-radius:6px; -moz-border-radius:6px; border-color:#a9d7cc;">
                                        <tr style="border-collapse:separate;border:solid black 1px;border-radius:6px; -moz-border-radius:6px; border-color:#a9d7cc">
                                            <td width="40%" style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;"><b>Patient ID</b></td>
                                            <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;">@Model.PatientID </td>
                                        </tr>
                                        <tr style="border-collapse:separate;border:solid black 1px;border-radius:6px; -moz-border-radius:6px; border-color:#a9d7cc">
                                            <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;"><b>Patient Name</b></td>
                                            <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;">@Model.PatientName</td>

                                        </tr>
                                        <tr style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc">
                                            <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;"><b>DOB</b></td>
                                            <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; padding:5px 5px;">@Model.DOB</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="pull-right">
                    @if (Convert.ToBoolean(ViewBag.IsReadOnly))
                    {
                    <button id="activate-prev-1" disabled name="BtnPrevious" class="btn btn-primary btn-lg">Previous</button>
                        if (Model.Declaration == true)
                        {
                        <button disabled="disabled" id="activate-step-3" name="BtnSave" class="btn btn-primary btn-lg">Finish</button>
                        }
                        else
                        {
                        <button id="activate-step-3" disabled name="BtnSave" class="btn btn-primary btn-lg">Finish</button>
                        }
                    }
                    else
                    {
                        <button id="activate-prev-1" name="BtnPrevious" class="btn btn-primary btn-lg">Previous</button>
                        if (Model.Declaration == true)
                        {
                            <button id="activate-step-3" disabled name="BtnSave" class="btn btn-primary btn-lg">Finish</button>
                        }
                        else
                        {
                            <button id="activate-step-3" name="BtnSave" class="btn btn-primary btn-lg">Finish</button>
                        }
                    }
                </div>
            @*}*@
        </div>
    </div>
   @if (@TempData["AlertMessage"] != null)
   {
       <script>alert("@TempData["AlertMessage"]")</script>
   }
    @*<span style="color:red">&nbsp;&nbsp;&nbsp;&nbsp;@TempData["AlertMessage"]</span><br />*@
</div>
<br />
<br />
@*<div class="pull-right">
        <button class="btn btn-primary btn-lg" id="btnClose6">Close</button>
        </div>
    </div>*@
<div class="modal fade" id="modelClose6">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Message</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="form-section" style="text-align:left">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row_bar">
                                <div>Do you want to exit without saving your changes?</div>
                            </div>
                        </div>
                        <br />
                        <br />
                        <div class="col-md-4">
                            <button type="button" class="btn btn-primary btn-block" id="btnModelClose1" data-dismiss="modal" formmethod="post" onclick="location.href='@Url.Action("MortalityReview", "Home", new { id=Model.Patient_ID })'">Yes</button>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-primary btn-block" name="btnCloseYes" id="btnCloseYes">No</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#btnClose6").click(function () {
            $("#modelClose6").modal();
        });
    });
    $("#activate-prev-1").on("click", function () {
        window.location.href = "@Url.Action("PositiveFeedback", "Home", new { id = Model.Patient_ID })";
    });
    $("#activate-step-3").on("click", function ()
    {
        var declaration = $("#Declaration").is(":checked");
        var specialityid = 0;
        $.ajax({
            type: "POST",
            url: "@Url.Action("SaveDeclaration", "Home")",
          //  contentType: "application/json; charset=utf-8",
            data: { Isdec: declaration, id: @Model.Patient_ID, specialityid: specialityid },

            success: function (result) {
                if (result == false) {
                    alert("Declaration can be completed only after the Medical Examiner Decision and SJR Assessment forms are completed.");
                    return false;
                }
                else
                {
                    window.location.href = "@Url.Action("MortalityReview", "Home", new { id = Model.Patient_ID })";
                }
                 

            },
            error: function (data) {
                debugger;
            }
            });
    })
</script>
<script type="text/javascript">
$(function () {
    $("#btnModelClose6").click(function () {
window.location.href = "@Url.Action("MortalityReview", "Home", new { id = Model.Patient_ID }))";
});
});
</script>
<script>
        $(document).ready(function () {
            $("#btnCloseYes").click(function () {
                $("#modelClose6").modal('hide');
            });
        });
</script>
<script>
        $(document).ready(function () {
            $("#Declaration").click(function () {
                if ($(this).is(":checked")) {
                    $("#dvNameLabel").css("display", "block");
                    $("#dvNameSpan").css("display", "block");
                    $("#dvOfficeLabel").css("display", "block");
                    $("#dvOfficeSpan").css("display", "block");
                    $("#dvDateLabel").css("display", "block");
                    $("#dvDateSpan").css("display", "block");
                    //$("#dvddlSpeciality").css("display", "block");
                    //$("#dvSpeciality").css("display", "block");
                }
                else {
                    $("#dvNameLabel").css("display", "none");
                    $("#dvNameSpan").css("display", "none");
                    $("#dvOfficeLabel").css("display", "none");
                    $("#dvOfficeSpan").css("display", "none");
                    $("#dvDateLabel").css("display", "none");
                    $("#dvDateSpan").css("display", "none");
                    //$("#dvddlSpeciality").css("display", "none");
                    //$("#dvSpeciality").css("display", "none");
                }
            });
        });
</script>

